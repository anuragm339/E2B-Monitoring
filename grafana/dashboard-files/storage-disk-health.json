{
  "title": "Storage & Disk Health",
  "uid": "storage-disk-health",
  "tags": ["storage", "disk", "iops", "latency"],
  "timezone": "browser",
  "schemaVersion": 27,
  "version": 1,
  "refresh": "5s",
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "panels": [
    {
      "id": 1,
      "title": "Read IOPS",
      "type": "stat",
      "gridPos": {"x": 0, "y": 0, "w": 6, "h": 6},
      "targets": [{
        "expr": "rate(broker_storage_reads_total[1m])",
        "refId": "A"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 100},
              {"color": "orange", "value": 500},
              {"color": "red", "value": 1000}
            ]
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "background"
      }
    },
    {
      "id": 2,
      "title": "Write IOPS",
      "type": "stat",
      "gridPos": {"x": 6, "y": 0, "w": 6, "h": 6},
      "targets": [{
        "expr": "rate(broker_storage_writes_total[1m])",
        "refId": "A"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 100},
              {"color": "orange", "value": 500},
              {"color": "red", "value": 1000}
            ]
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "background"
      }
    },
    {
      "id": 3,
      "title": "Read Latency (p99)",
      "type": "stat",
      "gridPos": {"x": 12, "y": 0, "w": 6, "h": 6},
      "targets": [{
        "expr": "broker_storage_read_latency_seconds{quantile=\"0.99\"}",
        "refId": "A"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 4,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 0.01},
              {"color": "orange", "value": 0.05},
              {"color": "red", "value": 0.1}
            ]
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "background"
      }
    },
    {
      "id": 4,
      "title": "Write Latency (p99)",
      "type": "stat",
      "gridPos": {"x": 18, "y": 0, "w": 6, "h": 6},
      "targets": [{
        "expr": "broker_storage_write_latency_seconds{quantile=\"0.99\"}",
        "refId": "A"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 4,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 0.01},
              {"color": "orange", "value": 0.05},
              {"color": "red", "value": 0.1}
            ]
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "background"
      }
    },
    {
      "id": 5,
      "title": "Storage Read/Write IOPS",
      "type": "timeseries",
      "gridPos": {"x": 0, "y": 6, "w": 12, "h": 8},
      "targets": [
        {
          "expr": "rate(broker_storage_reads_total[1m])",
          "legendFormat": "Reads",
          "refId": "A"
        },
        {
          "expr": "rate(broker_storage_writes_total[1m])",
          "legendFormat": "Writes",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "decimals": 2,
          "color": {"mode": "palette-classic"},
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 10
          }
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "Reads"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Writes"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}
            ]
          }
        ]
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "calcs": ["lastNotNull", "mean", "max"]
        }
      }
    },
    {
      "id": 6,
      "title": "Container Disk I/O (cAdvisor)",
      "type": "timeseries",
      "gridPos": {"x": 12, "y": 6, "w": 12, "h": 8},
      "targets": [
        {
          "expr": "rate(container_fs_reads_bytes_total{id=~\".*/6517fa308e8c.*\"}[1m])",
          "legendFormat": "Read (Bytes/sec)",
          "refId": "A"
        },
        {
          "expr": "rate(container_fs_writes_bytes_total{id=~\".*/6517fa308e8c.*\"}[1m])",
          "legendFormat": "Write (Bytes/sec)",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "Bps",
          "decimals": 0,
          "color": {"mode": "palette-classic"},
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 10
          }
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "Read (Bytes/sec)"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Write (Bytes/sec)"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "blue", "mode": "fixed"}}
            ]
          }
        ]
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "calcs": ["lastNotNull", "mean", "max"]
        }
      }
    },
    {
      "id": 7,
      "title": "Read Latency Percentiles",
      "type": "timeseries",
      "gridPos": {"x": 0, "y": 14, "w": 12, "h": 8},
      "targets": [
        {
          "expr": "broker_storage_read_latency_seconds{quantile=\"0.5\"}",
          "legendFormat": "p50",
          "refId": "A"
        },
        {
          "expr": "broker_storage_read_latency_seconds{quantile=\"0.95\"}",
          "legendFormat": "p95",
          "refId": "B"
        },
        {
          "expr": "broker_storage_read_latency_seconds{quantile=\"0.99\"}",
          "legendFormat": "p99",
          "refId": "C"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 4,
          "color": {"mode": "palette-classic"},
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 10
          }
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "p50"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "p95"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "yellow", "mode": "fixed"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "p99"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}
            ]
          }
        ]
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "calcs": ["lastNotNull", "mean", "max"]
        }
      }
    },
    {
      "id": 8,
      "title": "Write Latency Percentiles",
      "type": "timeseries",
      "gridPos": {"x": 12, "y": 14, "w": 12, "h": 8},
      "targets": [
        {
          "expr": "broker_storage_write_latency_seconds{quantile=\"0.5\"}",
          "legendFormat": "p50",
          "refId": "A"
        },
        {
          "expr": "broker_storage_write_latency_seconds{quantile=\"0.95\"}",
          "legendFormat": "p95",
          "refId": "B"
        },
        {
          "expr": "broker_storage_write_latency_seconds{quantile=\"0.99\"}",
          "legendFormat": "p99",
          "refId": "C"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 4,
          "color": {"mode": "palette-classic"},
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 10
          }
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "p50"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "p95"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "yellow", "mode": "fixed"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "p99"},
            "properties": [
              {"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}
            ]
          }
        ]
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom",
          "calcs": ["lastNotNull", "mean", "max"]
        }
      }
    },
    {
      "id": 9,
      "title": "Active Storage Segments",
      "type": "timeseries",
      "gridPos": {"x": 0, "y": 22, "w": 8, "h": 8},
      "targets": [{
        "expr": "broker_storage_segments_active",
        "legendFormat": "Active Segments",
        "refId": "A"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 0,
          "color": {"mode": "palette-classic"},
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 20
          }
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "calcs": ["lastNotNull", "mean", "max"]
        }
      }
    },
    {
      "id": 10,
      "title": "Read vs Write Distribution",
      "type": "timeseries",
      "gridPos": {"x": 8, "y": 22, "w": 8, "h": 8},
      "targets": [
        {
          "expr": "rate(broker_storage_reads_total[1m]) / (rate(broker_storage_reads_total[1m]) + rate(broker_storage_writes_total[1m])) * 100",
          "legendFormat": "Read %",
          "refId": "A"
        },
        {
          "expr": "rate(broker_storage_writes_total[1m]) / (rate(broker_storage_reads_total[1m]) + rate(broker_storage_writes_total[1m])) * 100",
          "legendFormat": "Write %",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "min": 0,
          "max": 100,
          "color": {"mode": "palette-classic"},
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 20
          }
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "calcs": ["lastNotNull", "mean"]
        }
      }
    },
    {
      "id": 11,
      "title": "Disk I/O Time",
      "type": "timeseries",
      "gridPos": {"x": 16, "y": 22, "w": 8, "h": 8},
      "targets": [{
        "expr": "rate(container_fs_io_time_seconds_total{id=~\".*/6517fa308e8c.*\"}[1m])",
        "legendFormat": "I/O Time (sec/sec)",
        "refId": "A"
      }],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "decimals": 3,
          "color": {"mode": "palette-classic"},
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 10
          }
        }
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "calcs": ["lastNotNull", "mean", "max"]
        }
      }
    }
  ],
  "datasource": {
    "type": "prometheus",
    "uid": "prometheus-datasource"
  }
}
